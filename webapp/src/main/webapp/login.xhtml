<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="jakarta.faces.html" xmlns:f="jakarta.faces.core">

<h:head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Link CSS -->
    <link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/css/auth-styles.css" />
    <title>WealthMate - Login</title>
</h:head>

<h:body>

    <div class="container">

        <div class="card fade-in-up">

            <!-- LOGO -->
            <div class="logo" style="text-align:center;">
                <img src="#{request.contextPath}/resources/images/Logo-W_black.png" alt="WealthMate Logo"
                    style="width: 120px; margin-bottom: 5px;" />
            </div>

            <h1>Welcome Back.</h1>

            <!-- FORM -->
            <h:form id="loginForm" styleClass="form">

                <!-- Error Messages - Inside form for proper AJAX update -->
                <h:panelGroup id="messagePanel" layout="block" style="margin-bottom: 20px;">
                    <h:messages id="loginMessages" globalOnly="true" styleClass="error-message-container"
                        errorClass="error-message" warnClass="warning-message" infoClass="success-message"
                        layout="table" />
                </h:panelGroup>

                <label>Email Address</label>
                <h:inputText id="email" value="#{loginBean.email}" styleClass="input" required="true"
                    requiredMessage="Please enter your email address" validatorMessage="Invalid email format"
                    placeholder="Enter your email">
                    <f:validateRegex pattern="^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$" />
                </h:inputText>

                <label>Password</label>
                <div class="password-wrapper">
                    <h:inputSecret id="password" value="#{loginBean.password}" styleClass="input password-input"
                        required="true" requiredMessage="Please enter your password"
                        placeholder="Enter your password" />
                    <span class="toggle-password" onclick="togglePassword()">
                        <!-- Eye icon (visible by default - password hidden) -->
                        <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        <!-- Eye-off icon (hidden by default - password visible) -->
                        <svg id="eyeOffIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" style="display:none;">
                            <path
                                d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                            </path>
                            <line x1="1" y1="1" x2="23" y2="23"></line>
                        </svg>
                    </span>
                </div>

                <div style="text-align:center; margin-top: 35px;">
                    <h:commandButton value="Log In" action="#{loginBean.login}" styleClass="login-btn"
                        style="display:inline-block; margin:0 auto;">
                        <f:ajax execute="@form" render="messagePanel" onevent="onLoginSubmit" />
                    </h:commandButton>
                </div>
            </h:form>

            <p class="footer-text">
                Don't have an account yet?
                <h:outputLink value="#{request.contextPath}/register.xhtml">
                    Sign Up
                </h:outputLink>
            </p>

        </div> <!-- end of .card -->
    </div> <!-- end of .container -->

    <!-- JavaScript for password toggle and error animations -->
    <script type="text/javascript">
        //<![CDATA[
        function togglePassword() {
            var passwordField = document.getElementById('loginForm:password');
            var eyeIcon = document.getElementById('eyeIcon');
            var eyeOffIcon = document.getElementById('eyeOffIcon');

            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                eyeIcon.style.display = 'none';
                eyeOffIcon.style.display = 'block';
            } else {
                passwordField.type = 'password';
                eyeIcon.style.display = 'block';
                eyeOffIcon.style.display = 'none';
            }
        }

        function onLoginSubmit(data) {
            if (data.status === 'success') {
                // Check if there are error messages
                var msgPanel = document.getElementById('loginForm:messagePanel');
                if (msgPanel && msgPanel.querySelector('.error-message')) {
                    // Find which field has error and add shake animation
                    var errorText = msgPanel.textContent.toLowerCase();

                    if (errorText.includes('email')) {
                        shakeInput('loginForm:email');
                    }
                    if (errorText.includes('password') || errorText.includes('credentials')) {
                        shakeInput('loginForm:password');
                    }

                    // Auto-dismiss after 5 seconds
                    setTimeout(function () {
                        var messages = msgPanel.querySelectorAll('.error-message, .warning-message');
                        messages.forEach(function (msg) {
                            msg.classList.add('message-fadeout');
                        });
                    }, 5000);
                }
            }
        }

        function shakeInput(inputId) {
            var input = document.getElementById(inputId);
            if (input) {
                input.classList.add('input-error');
                // Remove the class after animation completes
                setTimeout(function () {
                    input.classList.remove('input-error');
                }, 600);
            }
        }
        //]]>
    </script>

</h:body>

</html>